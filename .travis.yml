language: node_js
node_js:
  - 10
os: linux
cache: yarn
# Handle git submodules yourself
# see https://stackoverflow.com/a/24600210
git:
  submodules: false
# Use sed to replace the SSH URL with the public URL, then initialize submodules
# see https://stackoverflow.com/a/24600210
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - npm config set spin false
  - npm install --global yarn
install:
  - yarn install
script:
  - yarn build
# Package all files into an archive file
# see https://github.com/afragen/github-updater/blob/develop/.travis.yml
before_deploy:
  - git archive -o /tmp/dfh-plugin-${TRAVIS_TAG}.zip --prefix=dfh-plugin/ ${TRAVIS_COMMIT}
deploy:
  - provider: releases
    token: $GITHUB_TOKEN
    file: /tmp/dfh-plugin-${TRAVIS_TAG}.zip
    skip_cleanup: true
    overwrite: true
    on:
      tags: true
