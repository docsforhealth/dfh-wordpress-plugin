language: node_js
node_js:
  - 10
os: linux
branches:
  only:
    - master
cache: yarn
# Handle git submodules yourself
# see https://stackoverflow.com/a/24600210
git:
  submodules: false
# Use sed to replace the SSH URL with the public URL, then initialize submodules
# see https://stackoverflow.com/a/24600210
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - npm config set spin false
  - npm install --global yarn
install:
  - yarn install
before_deploy:
  - yarn build
deploy:
  - provider: releases
    token: $GITHUB_TOKEN
    file_glob: true
    file:
      - ./assets/**/*
      - ./build/**/*
      - ./inc/**/*
      - ./*.php
    skip_cleanup: true
    overwrite: true
    on:
      tags: true
